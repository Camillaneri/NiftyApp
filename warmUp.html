<!DOCTYPE html>
<html>
    <head>
        <title>NiftyEValue</title>
        <!-- Required meta tags -->
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <!--<link rel="stylesheet" href="owlcarousel/owl.carousel.min.css">
        <link rel="stylesheet" href="owlcarousel/owl.theme.default.min.css"> -->
        <link rel="stylesheet" href="style.css">
        <link rel="stylesheet" href="style/modalsurvey.css">

        <!-- Icons -->
        <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.8.1/font/bootstrap-icons.css">
        
  
        <!-- Bootstrap CSS -->
        
        <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-1BmE4kWBq78iYhFldvKuhfTAU6auU8tT94WrHftjDbrCEXSU1oBoqyl2QvZ6jIW3" crossorigin="anonymous">
        <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
        <script src="https://kit.fontawesome.com/bc67555ac1.js" crossorigin="anonymous"></script>
    </head>
    <body id="bod" class="darkGreen"> <!-- class="d-flex flex-column"  onload="placeholders()"-->

          <!-- tutorial -->
    
          <div class="position-absolute bgdark50 h-100 w-100 reveal" id="tutorials">
            <div class="position-absolute w-40 bg-dark white z-2000 p-3 br1" id="tutorial1">
                <h1>this is the Reference image</h1>
                
                <p>look this artpiece closely and judge the other image based on how much the are similar to to it</p>
                
                
                <button type="button" class="btn btn-success" id="toTut2a">Next</button>
            </div>

            <div class="position-absolute bg-dark white z-2000 p-3 br1" id="tutorial2">
                <h1>Fetched images</h1>
                <p id="tail">Look at these artworks and decide wich one look more similar to the reference image based on shape, color, and art style, then drag and drop them in the numbered slots.</p>
                <p>first slot for the most similar, second slot for the second most similar, and so on.</p>
                
                <button type="button" class="btn btn-success" id="toTut1">Back</button>
                <button type="button" class="btn btn-success" id="toTut3">Next</button>
            </div>
            <div class="position-absolute w-50 bg-dark white z-2000 p-3 br1" id="tutorial3">
                <h1>End task</h1>
                <p>When you are done click on the "end task" button. </p>
                <p>if you want to repeat the task click on "repeat task", you can do it as many time as you'd like!</p>
                <button type="button" class="btn btn-success" id="toTut2b">Back</button>
                <button type="button" class="btn btn-success" id="FinishTut">Got it!</button>
            </div>

        </div>
        

                <!-- Display img-->
        
                <div class="z-2000 position-absolute" id="shadow">
                    <div class="white bg-dark br1 imgsubst" id="displayimg">
                        <span class="closeimg" onclick="closeimg()">&times;</span>
                        <!--<button type="button" class="btn btn-success" id="closeimg" onclick="closeimg()">x</button>-->
                        <img id="displayed" src="" class="w-15" alt="...">
                    </div>
            </div>
           
        

         <!-- header -->
         <div class="py-4 almostBlack" id="Header">
            <span class="d-flex justify-content-between" id="head">
                <span class="text-left text-light me-5"> NiftyEValue</span> 
                <span class="text-right text-light" id="pageName">Home</spandes>
            </span>
        </div>
        <!-- Navbar -->
        <nav class="navbar navbar-expand-sm gray navbar-dark">
            <div class="container-fluid" id="navcontainer">
              <ul class="navbar-nav">
                <li class="nav-item">
                    <a class="navnolink py-3 px-5 " >Start</a>
                  </li>
                <li class="nav-item">
                  <a class="navnolink py-3 px-5 ">Pre survey</a>
                </li>
                <li class="nav-item">
                  <a class="navnolink py-3 px-5  lightgreen text-dark" >First Task</a>
                </li>
                <li class="nav-item">
                  <a class="navnolink py-3 px-5" >Second Task</a>
                </li>
                <li class="nav-item">
                  <a class="navnolink py-3 px-5" >Post survey</a>
                </li>
                <li class="nav-item">
                    <a class="navnolink py-3 px-5 ">End</a>
                  </li>
                <li class="nav-item">
                    <a class="navnolink pt-2 px-5 text-center position-absolute pincontainer" href="#">
                        
                        <span class="dot text-dark text-center"><i class="fa-solid fa-question trbackgr"></i></span>
                    </a>
                  </li>
                <!-- <li class="nav-item">
                    <a class="navnolink text-center mt-2 me-3 position-absolute pincontainer" href="#">
                        <span class="dot text-dark text-center">?</span>
                    </a>
                  </li> -->
              </ul>
            </div>
          </nav>
        
       

        <!-- introduction page -->

        <div class="col" id="introwarmup">
            <div class="container py-5 px-5 my-5 rounded-3 text-center" id="centralBox">
                <h1 class="display-3 pb-3 " id="headerTitle2">First Task</h1>
                <p>Help us evaluate how precise is our retrieval algorithm,</p> 
                <p> You will be asked to rank a series of artworks based on their similarity to a reference image.</p> 
                <p> Your feedback will be used to improve our system of recommendation, and help future users find artworks that interest and inspire them!                    
                </p>    
            </div>
        </div>
        
       

        <!-- Task -->
        <div class="d-flex reveal zindex" id="task">    <!-- big container-->

            <div class="col-xl-4 flex-column px-5 almostBlack" id="refimg">   <!--column1-->
                <!-- <div class="my-3 text-light">  --text--
                    <h3>Reference image</h3>
                    
                </div> -->       
                <div class="px-0 my-4" id="refimgcont1">  <!--img--> 
                    <div class="aclass" id="refimgcontainer">            
                        <div id="RefImg" class="position-relative text-center imgsubst"> 
    
                            <img id="reference" class="REF" src=""> 
                        </div>     
                    </div>                      
                </div>
                <div class="p-2 bg-white mb-3">  <!--text-->
                    <h4>Task</h4>
                    <p class="lead">
                        Order the images based on their similarity to the reference image</p>
                </div> 
                <div class="my-3 d-flex" id="buttons2"> <!-- buttons -->
                    <div class="col-6 p-1"> 
                        <button class="w-100 col-6 btn btn-success py-2 px-4"  type="button"  onclick="repeattask()" >
                        Repeat task
                        </button>    
                
                          
                         
                    </div>
                    <div class="col-6 p-1">
                        <button class="w-100 col-6 btn btn-success py-2 px-4" type="button" data-bs-toggle="modal" data-bs-target="#exampleModal" onclick="endTask()"> 
                        End task
                        </button>  
                    </div>                 
                        
                </div>    
            </div>    

            <div class="position-relative mx-auto flex-fill" id="clumnN2">   <!--column2--> 
                <div class="p-4 collapse show almostBlack" id="Small">  <!--Small--> 
                    <div class="dropboxes d-flex pb-2 overflowY almostBlack">
                        <div class="getDatabox1">                     
                            <div id="getData21" ondrop="drop(event)" ondragover="allowDrop(event)" class="position-relative myDiv text-center tall-img" >            
                                <button class="position-absolute cross-btn btn-dark align-self-end d-none pincontainer" onclick="clearImg(event)">x</button> 
                                <div class="position-absolute m-1 z-1 border-dot">
                                    #1
                                </div> 
                                <img id="WUimg1" class="img-fit" src="">
                            </div>        
                        </div>   
                        <div class="getDatabox1">                          
                            <div id="getData22" ondrop="drop(event)" ondragover="allowDrop(event)" class="position-relative myDiv text-center tall-img" >            
                                <button class="position-absolute cross-btn btn-dark align-self-end d-none pincontainer" onclick="clearImg(event)">x</button> 
                                <div class="position-absolute m-1 z-1 border-dot">
                                    #2
                                </div> 
                                <img id="WUimg2" class="img-fit" src="">
                            </div>          
                        </div>        
                        <div class="getDatabox1"> 
                            <div id="getData23" ondrop="drop(event)" ondragover="allowDrop(event)" class="position-relative myDiv text-center tall-img" >            
                                <button class="position-absolute cross-btn btn-dark align-self-end d-none pincontainer" onclick="clearImg(event)">x</button> 
                                <div class="position-absolute m-1 z-1 border-dot">
                                    #3
                                </div> 
                                <img id="WUimg3" class="img-fit" src="">
                            </div>       
                        </div>        
                        <div class="getDatabox1">            
                            <div id="getData24" ondrop="drop(event)" ondragover="allowDrop(event)" class="position-relative myDiv text-center tall-img" >            
                                <button class="position-absolute cross-btn btn-dark align-self-end d-none pincontainer" onclick="clearImg(event)">x</button> 
                                <div class="position-absolute m-1 z-1 border-dot">
                                    #4
                                </div> 
                                <img id="WUimg4" class="img-fit" src="">
                            </div>         
                        </div>        
                        <div class="getDatabox1">     
                            <div id="getData25" ondrop="drop(event)" ondragover="allowDrop(event)" class="position-relative myDiv text-center tall-img" >            
                                <button class="position-absolute cross-btn btn-dark align-self-end d-none pincontainer" onclick="clearImg(event)">x</button> 
                                <div class="position-absolute m-1 z-1 border-dot">
                                    #5
                                </div> 
                                <img id="WUimg5" class="img-fit" src="">
                            </div>        
                        </div>  
                    </div>       
                </div>  
                <div class="flex-grow-1 text-center" id="linguetta">
                    <button type="button" class="almostBlack" onclick="arrowDown()" id="arrowDownButton">.</button>
                </div>
                <div class="flex-grow-1 justify-content-center text-center mb-3" >
                    <button type="button" class="almostBlack collapse" onclick="arrowUp()" id="arrowUpButton">.</button>
                </div>

                <div class="position-relative px-3 pb-5 d-flex flex-wrap mx-auto overflowY dcenter-item" id="coso">    
                     <div class="position-relative simimages imgsubst ms-3 mb-3"  onclick="display_img(event)"  id="similarBox0" draggable="true" ondragstart="drag(event)">
                        <img value="0" src="" draggable="true" class="img max-h-50 w-100 recover similarImg0"  id="">
                
                    </div> 
                     <div class="position-relative simimages imgsubst ms-3 mb-3"  onclick="display_img(event)"  id="similarBox1" draggable="true" ondragstart="drag(event)">
                        <img value="0" src="" draggable="true" class="img max-h-50 w-100 recover similarImg0"  id="">
                    </div> 
                     <div class="position-relative simimages imgsubst ms-3 mb-3"  onclick="display_img(event)"  id="similarBox2" draggable="true" ondragstart="drag(event)">
                        <img value="0" src="" draggable="true" class="img max-h-50 w-100 recover similarImg0"  id="">
                    </div> 
                     <div class="position-relative simimages imgsubst ms-3 mb-3"  onclick="display_img(event)"  id="similarBox3" draggable="true" ondragstart="drag(event)">
                        <img value="0" src="" draggable="true" class="img max-h-50 w-100 recover similarImg0"  id="">
                    </div>
                     <div class="position-relative simimages imgsubst ms-3 mb-3"  onclick="display_img(event)"  id="similarBox4" draggable="true" ondragstart="drag(event)">
                        <img value="0" src="" draggable="true" class="img max-h-50 w-100 recover similarImg0"  id="">
                    </div>     
                </div> 
            </div>
                
        </div>
        

   
        
        <!-- Footer -->
        <footer class="mt-auto  py-4 almostBlack text-white-50" id="MainFooter">
            <div class="container text-center">
            <small>Copyright &copy; Your Website</small>
            </div>
      </footer>    

       <!-- Modal -->
       <div class="modal fade h-auto" id="exampleModal" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
        <div class="modal-dialog">
          <div class="modal-content">
            <div class="modal-header">
              <h5 class="modal-title" id="exampleModalLabel">Before we move on...</h5>
              <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <form class="" id="WU-form"> 
                    <div class="p-3"> 
                        <p for="PresurveyInput5" class="lead">On a scale from 1 to 5 how much satisfied are you after this task?</p>
                        <div class="inline slider text-center">
                            <input class="form-range"  type="range" min="1" max="5"  step="1" id="nftExp" name="Satisfaction" required/>
                            <ul class="vals">
                                <li class="text-center">1</li>
                                <li class="text-center">2</li>
                                <li class="text-center">3</li>
                                <li class="text-center">4</li>
                                <li class="text-center">5</li>
                            </ul>
                        </div>
                    </div>
                    <section class="p-3">
                        <p class="lead">Have you encountered one of the following issues?</p>
                        
                        <div class="p-3 entry-field"> 
                            <div class="form-check"> 
                                <input class="form-check-input" type="checkbox" name="Issues" id="ArtExp1" value="toosimilar">
                                <label class="form-check-label" for="ArtExp1">Images were too similar to each other</label> 
                            </div>
                            <div class="form-check"> 
                                <input class="form-check-input" type="checkbox" name="Issues" id="ArtExp2" value="toodifferent">
                                <label class="form-check-label" for="ArtExp2">Images were too different to each other</label> 
                            </div>
                            <div class="form-check"> 
                                <input class="form-check-input" type="checkbox" name="Issues" id="ArtExp3" value="longloadinh">
                                <label class="form-check-label" for="ArtExp3">Loading time was too long</label> 
                            </div>
                            <div class="form-check"> 
                                <input class="form-check-input" type="checkbox" name="Issues" id="ArtExp5" value="None">
                                <label class="form-check-label" for="ArtExp5">None of the above</label> 
                            </div>
                        </div> 
                        
                    </section>
                    <section class="p-3">
                
                        <p class="lead">Do you have any additional comment?</p>
                        <p>Impressions on the algorithm, additional issues, advices</p>
                        <div class="input-group mb-3">
                            <input type="text" class="form-control" placeholder="Comments" aria-label="Comments" name="Comments">
                        <div class=" container py-3 px-0"> 
                            <span class="d-inline-block" tabindex="0">
                                <button type="submit" class="btn btn-success me-5 px-4 float-end w-25" id="submit">
                                    Submit! 
                                </button> 
                            </span>
                        </div>  
                    </section>
                </form>
            </div>
            <!-- <div class="modal-footer">
              <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
              <button type="button" class="btn btn-success" onclick="repeatask()">Save changes</button>
            </div> -->
          </div>
        </div>
    </body>   
    <!-- <script src="jquery.min.js"></script>
  <script src="owlcarousel/owl.carousel.min.js"></script> -->  
    <script src="https://unpkg.com/@supabase/supabase-js"></script>
       <script type="module">

        import { createClient } from 'https://cdn.jsdelivr.net/npm/@supabase/supabase-js/+esm'
        const supabase2 = createClient('https://cgvvgwcioxjnzpgxisbu.supabase.co', 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImNndnZnd2Npb3hqbnpwZ3hpc2J1Iiwicm9sZSI6ImFub24iLCJpYXQiOjE2NTM3MzM0MzUsImV4cCI6MTk2OTMwOTQzNX0.Ot2PkSTOWzi4RWs_gIsL3g1heXsDYCzflOyBocR-n5U')
      
        console.log('Supabase Instance: ', supabase2)
        let myId = sessionStorage.getItem('id');
        
        var refimg = sessionStorage.getItem('WUreference');

        console.log(myId)
        const form = document.querySelectorAll('#WU-form')
        form[0].addEventListener('submit', async (event) => {

            event.preventDefault()

        var AIorder = sessionStorage.getItem('AIorder0');
        var Uorder = sessionStorage.getItem('userOrder');

        var submission = {'user':myId, 'refID':refimg, 'AIorder ':AIorder, 'UserOrder':Uorder}
            const formInputs = form[0].querySelectorAll('input[name = Satisfaction], input[name = Issues]:checked, input[name = Comments]')
            
            // scrivere qui gli altri log 
            formInputs.forEach( element =>{
                const { value, name } = element
                if (value) {

                    if (submission[name] != undefined){
                    submission[name]=submission[name]+', '+value}else{submission[name]=value}
                
                }
            })

            console.log('submission', submission)
            await supabase2.from('Warm_up').insert([submission])
            window.location.href = "Task.html"

        })
      </script>

        <script src="./surveyWU.js"></script>
        <script src="https://code.jquery.com/jquery-3.2.1.slim.min.js" integrity="sha384-KJ3o2DKtIkvYIK3UENzmM7KCkRr/rE9/Qpg6aAZGJwFDMVNA/GpGFF93hXpG5KkN" crossorigin="anonymous"></script> 
        
        <script src="https://cdn.jsdelivr.net/npm/popper.js@1.12.9/dist/umd/popper.min.js" integrity="sha384-ApNbgh9B+Y1QKtv3Rn7W3mgPxhU9K/ScQsAP7hUibX39j7fakFPskvXusvfa0b4Q" crossorigin="anonymous"></script>
        <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.0.0/dist/js/bootstrap.min.js" integrity="sha384-JZR6Spejh4U02d8jOt6vLEHfe/JQGiRRSQQxSfFWpi1MquVdAyjUar5+76PVCmYl" crossorigin="anonymous"></script>
        
        <script src="WUrequests.js"></script>
        <script src="WUfunctions.js"></script>
        <script src="WU-logs.js"></script>

</html>
